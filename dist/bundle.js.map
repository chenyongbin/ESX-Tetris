{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/config.js","webpack:///./src/canvas.js","webpack:///./src/util.js","webpack:///./src/screen/block.js","webpack:///./src/engine/db.js","webpack:///./src/bootstrap.js","webpack:///./src/gamepanel.js","webpack:///./src/screen/index.js","webpack:///./src/screen/matrix.js","webpack:///./src/screen/state.js","webpack:///./src/screen/digitsequence.js","webpack:///./src/screen/digit.js","webpack:///./src/control/index.js","webpack:///./src/control/button.js","webpack:///./src/engine/index.js","webpack:///./src/engine/timer.js","webpack:///./src/engine/builder.js","webpack:///./src/engine/shape.js","webpack:///./src/engine/animation.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","panel","screenMargin","screenBackgroundColor","screenHeightProportion","controlMargin","backgroundColor","screen","padding","matrix","borderWidth","blockSize","bgBlockBorderColor","bgBlockBackgroundColor","blockBorderColor","blockBackgroundColor","highlightBlockBorderColor","highlightBlockBackgroundColor","state","font","fontSize","top","left","control","_util","Canvas","containerDOM","offsetX","offsetY","width","height","arguments","length","undefined","_classCallCheck","this","Error","canvas","document","createElement","appendChild","style","position","context","getContext","setStyles","strokeRect","fillRect","clearRect","measureText","fillText","fillHalfEllipse","fillCircle","getLinearGradient","styles","_this","Array","isArray","forEach","items","split","replace","x","y","options","extend","text","save","restore","radius","isHorizontal","anticlockwise","scale","fillStyle","scaleX","scaleY","startAngle","endAngle","Math","PI","beginPath","closePath","moveTo","arc","fill","x0","y0","x1","y1","colorStops","gradient","createLinearGradient","stop","addColorStop","color","fibonacciScore","fibonacci","dest","source","getScore","yCoordinates","newYCoordinates","sort","a","b","score","lastY","shift","curY","Block","size","margin","outline","core","isActive","activate","inactivate","outlineOptions","strokeStyle","coreOptions","sizeX","sizeY","COORDINATES","initialize","matrixSizeX","matrixSizeY","j","xArr","push","update","prevCoordinates","curCoordinates","_ref","_ref2","isAllFilled","some","checkWhetherHasReachedLeft","coordinates","hasReached","_loop","_coordinates$i","coordinate","_loop2","checkWhetherHasReachedRight","_loop3","_coordinates$i2","_loop4","checkWhetherHasReachedBottom","_loop5","_coordinates$i3","_loop6","getFilledYCoordinates","every","reset","callback","inactives","actives","emptyY","fillRow","clearRow","getElementById","GamePanel","Screen","getScreenOptions","Control","getControlOptions","screenMatrixSize","getSize","Engine","highlight","unhighlight","updateScore","updateEliminatedRowNum","updateNextShape","addDropEventHandler","onMoveDrop","addLeftEventHandler","onMoveLeft","addRightEventHandler","onMoveRight","addDownEventHandler","onMoveDown","addRotateEventHandler","onMoveRotate","addRestartEventHandler","onGameRestart","addPauseEventHandler","onGamePause","start","_config","screenOptions","controlOptions","clientWidth","clientHeight","PANEL_CONFIG","paddingX","paddingY","horizontalBlockNumber","verticalBlockNumber","MATRIX_CONFIG","SCREEN_CONFIG","floor","matrixWidth","matrixHeight","Matrix","State","bgCanvas","horizontalSize","verticalSize","BLOCKS_MAP","getBlockKey","block","lineWidth","Number","isNaN","scoreDigitSequence","eliminatedRowsDigitSequence","STATE_CONFIG","scoreHeight","eliminatedRowsHeight","scoreOffsetX","scoreOffsetY","eliminatedRowsOffsetX","eliminatedRowsOffsetY","nextShapeOffsetX","nextShapeOffsetY","DigitSequence","matrixOffsetX","matrixOffsetY","parseInt","show","rowNum","min","max","digitList","digitNumber","digitSpanProportion","Digit","isInteger","valueStr","toString","charAt","hide","showDigit","includes","digit","bgCanvs","scaleRadius","BUTTONS_MAP","BUTTONS_EVENTHANDLERS_MAP","Map","getControlOffsetAgainstPage","e","offsetLeft","offsetTop","offsetParent","controlPageX","controlPageY","addEventHandler","eventName","handler","handlers","set","executeEventHandler","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","iterator","next","done","err","return","CONTROL_CONFIG","Button","showShadow","stopColor1","stopColor2","_getControlOffsetAgai","onclick","clickX","pageX","clickY","pageY","contains","onkeydown","keyCode","sx","sy","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","shadownColor","textAlign","textBaseLine","sqrt","pow","SHAPES","SCREEN","elapsingObject","shape","totalScore","eliminatedRowNum","isHighlightAnimating","isPaused","clear","onTimerElapsed","BUILDER","getShape","getRawCoordinates","down","onShapeMoved","DB","onRowsFilled","ANIMATION","console","log","Date","toLocaleString","fillScreen","clearScreen","TIMER","resume","right","rotate","pause","inetrval","timerID","clearInterval","interval","setInterval","SquareShape","LShape","ReverseLShape","MoutainShape","LineShape","LittleHShape","ReverseLittleHShape","shapes","random","Function","apply","Shape","concat","_toConsumableArray","_len","states","_key","stateIndex","map","timestamp","now","getCoordinates","_this2","count","timer","clearTimeout","setTimeout"],"mappings":"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","file":"bundle.js?v=00ce38e","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","export const panel = {\n\tscreenMargin: 25,\n\tscreenBackgroundColor: '#9aae82',\n\tscreenHeightProportion: 0.7,\n\tcontrolMargin: 15,\n\tbackgroundColor: '#264d8f'\n};\n\nexport const screen = {\n\tpadding: 2\n};\n\nexport const matrix = {\n\tborderWidth: 3,\n\tblockSize: 18,\n\tbgBlockBorderColor: '#84946e',\n\tbgBlockBackgroundColor: '#84946e',\n\tblockBorderColor: '#010101',\n\tblockBackgroundColor: '#000',\n\thighlightBlockBorderColor: '#560000',\n\thighlightBlockBackgroundColor: '#560000'\n};\n\nexport const state = {\n\tfont: '16px Arial',\n\tfontSize: 16,\n\ttop: 20,\n\tleft: 10\n};\n\nexport const control = {\n\tpadding: 10\n};\n","import { extend } from \"./util\";\n\n/**\n * 画布类\n * @export Canvas\n * @class Canvas\n */\nexport default class Canvas {\n  constructor(\n    containerDOM,\n    offsetX,\n    offsetY,\n    width,\n    height,\n    name = \"undefined name canvas\"\n  ) {\n    if (!containerDOM) {\n      throw new Error(`Cannot find container for ${name}.`);\n    }\n\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n    this.width = width;\n    this.height = height;\n    this.name = name;\n    this.canvas = document.createElement(\"canvas\");\n    this.canvas.width = this.width;\n    this.canvas.height = this.height;\n    containerDOM.appendChild(this.canvas);\n    this.canvas.style.position = \"absolute\";\n    this.canvas.style.left = `${this.offsetX}px`;\n    this.canvas.style.top = `${this.offsetY}px`;\n    this.context = this.canvas.getContext(\"2d\");\n\n    this.setStyles = this.setStyles.bind(this);\n    this.strokeRect = this.strokeRect.bind(this);\n    this.fillRect = this.fillRect.bind(this);\n    this.clearRect = this.clearRect.bind(this);\n    this.measureText = this.measureText.bind(this);\n    this.fillText = this.fillText.bind(this);\n    this.fillHalfEllipse = this.fillHalfEllipse.bind(this);\n    this.fillCircle = this.fillCircle.bind(this);\n    this.getLinearGradient = this.getLinearGradient.bind(this);\n  }\n\n  setStyles(styles) {\n    if (Array.isArray(styles)) {\n      styles.forEach(style => {\n        let items = style.split(\":\");\n        if (items[0] in this.canvas.style) {\n          this.canvas.style[items[0]] = items[1].replace(\";\", \"\");\n        }\n      });\n    }\n  }\n\n  strokeRect(x, y, width, height, options) {\n    extend(this.context, options);\n    this.context.strokeRect(x, y, width, height);\n  }\n\n  fillRect(x, y, width, height, options) {\n    extend(this.context, options);\n    this.context.fillRect(x, y, width, height);\n  }\n\n  clearRect(x, y, width, height, options) {\n    extend(this.context, options);\n    this.context.clearRect(x, y, width, height);\n  }\n\n  measureText(text) {\n    return this.context.measureText(text).width;\n  }\n\n  fillText(text, x, y, options) {\n    this.context.save();\n    extend(this.context, options);\n    this.context.fillText(text, x, y);\n    this.context.restore();\n  }\n\n  fillHalfEllipse(\n    x,\n    y,\n    radius,\n    isHorizontal,\n    anticlockwise,\n    scale,\n    options = { fillStyle: \"black\" }\n  ) {\n    let scaleX = 1,\n      scaleY = 1,\n      startAngle = 0,\n      endAngle = 0;\n    if (isHorizontal === true) {\n      scaleY = scale;\n      endAngle = Math.PI;\n    } else {\n      scaleX = scale;\n      startAngle = Math.PI / 2;\n      endAngle = (Math.PI * 3) / 2;\n    }\n\n    this.context.save();\n    extend(this.context, options);\n    this.context.beginPath();\n    this.context.closePath();\n    this.context.moveTo(x, y);\n    this.context.scale(scaleX, scaleY);\n    this.context.arc(\n      x / scaleX,\n      y / scaleY,\n      radius,\n      startAngle,\n      endAngle,\n      anticlockwise\n    );\n    this.context.fill();\n    this.context.restore();\n  }\n\n  fillCircle(x, y, radius, startAngle, endAngle, anticlockwise, options = {}) {\n    this.context.save();\n    extend(this.context, options);\n    this.context.beginPath();\n    this.context.moveTo(x, y);\n    this.context.arc(x, y, radius, startAngle, endAngle, anticlockwise);\n    this.context.closePath();\n    this.context.fill();\n    this.context.restore();\n  }\n\n  getLinearGradient(x0, y0, x1, y1, colorStops = []) {\n    let gradient = this.context.createLinearGradient(x0, y0, x1, y1);\n    if (Array.isArray(colorStops)) {\n      colorStops.forEach(stop => {\n        gradient.addColorStop(stop.position, stop.color);\n      });\n    }\n    return gradient;\n  }\n}\n","const extend = (dest, source) => {\n\tfor (let p in source) {\n\t\tif (p in dest) {\n\t\t\tdest[p] = source[p];\n\t\t}\n\t}\n};\n\nconst getScore = (yCoordinates) => {\n\tif (!yCoordinates || yCoordinates.length == 0) return 0;\n\n\tlet newYCoordinates = [ ...yCoordinates ];\n\tnewYCoordinates.sort((a, b) => b - a);\n\tlet score = 0,\n\t\tlastY = newYCoordinates.shift(),\n\t\tcurY = newYCoordinates.shift(),\n\t\tn = 1;\n\twhile (curY) {\n\t\tif (curY - lastY == 1) {\n\t\t\tn++;\n\t\t} else {\n\t\t\tscore += fibonacciScore(n);\n\t\t\tn = 1;\n\t\t\tlastY = curY;\n\t\t}\n\t\tcurY = newYCoordinates.shift();\n\t}\n\treturn score + fibonacciScore(n);\n};\n\nconst fibonacciScore = (n) => {\n\tif (n == 1) return 10;\n\telse if (n == 2) return 20;\n\treturn fibonacci(n - 1) + fibonacci(n - 2);\n};\n\nexport { extend, getScore };\n","/**\n * 方块类\n * @export Block\n * @class Block\n */\nexport default class Block {\n  constructor(canvas, x, y, size) {\n    this.canvas = canvas;\n    this.x = x;\n    this.y = y;\n    this.size = size;\n    this.borderWidth = 1;\n    this.padding = 2;\n    this.margin = 2;\n\n    this.outline = {\n      x: this.x + this.margin,\n      y: this.y + this.margin,\n      size: this.size - this.margin * 2\n    };\n    this.core = {\n      x: this.outline.x + this.borderWidth + this.padding,\n      y: this.outline.y + this.borderWidth + this.padding,\n      size: this.outline.size - this.borderWidth * 2 - this.padding * 2\n    };\n\n    this.isActive = false;\n    this.activate = this.activate.bind(this);\n    this.inactivate = this.inactivate.bind(this);\n  }\n\n  activate(\n    outlineOptions = { strokeStyle: \"black\" },\n    coreOptions = { fillStyle: \"black\" }\n  ) {\n    if (this.isActive) return;\n    this.canvas.strokeRect(\n      this.outline.x,\n      this.outline.y,\n      this.outline.size,\n      this.outline.size,\n      outlineOptions\n    );\n    this.canvas.fillRect(\n      this.core.x,\n      this.core.y,\n      this.core.size,\n      this.core.size,\n      coreOptions\n    );\n    this.isActive = true;\n  }\n\n  inactivate() {\n    if (!this.isActive) return;\n    this.canvas.clearRect(this.x, this.y, this.size, this.size);\n    this.isActive = false;\n  }\n}\n","/**\n * @file 数据库模块\n * @version 1.0.0\n */\n\nlet sizeX = 0,\n  sizeY = 0,\n  length = 0;\nlet COORDINATES = [];\n\n/**\n * 初始化\n * @param {integer} matrixSizeX 矩阵X轴方向大小\n * @param {integer} matrixSizeY 矩阵Y轴方向大小\n */\nconst initialize = (matrixSizeX, matrixSizeY) => {\n  sizeX = matrixSizeX;\n  sizeY = matrixSizeY;\n  length = sizeX * sizeY;\n  for (let j = 0; j < sizeY; j++) {\n    let xArr = [];\n    for (let i = 0; i < sizeX; i++) {\n      xArr.push(0);\n    }\n    COORDINATES.push(xArr);\n  }\n};\n\n/**\n * 更新坐标\n * @param {Array<Object<x,y>>} prevCoordinates 上一个坐标集\n * @param {Array<Object<x,y>>} curCoordinates 当前坐标集\n */\nconst update = (prevCoordinates, curCoordinates) => {\n  prevCoordinates.forEach(({ x, y }) => {\n    x < sizeX && x >= 0 && y < sizeY && y >= 0 && (COORDINATES[y][x] = 0);\n  });\n  curCoordinates.forEach(({ x, y }) => {\n    x < sizeX && x >= 0 && y < sizeY && y >= 0 && (COORDINATES[y][x] = 1);\n  });\n};\n\n/**\n * 检查是否都充满了\n * @returns\n */\nconst isAllFilled = () => {\n  return COORDINATES[0].some(state => state == 1);\n};\n\n/**\n * 检查是否已到达左侧\n * @param {Array<Object<x,y>>} coordinates 坐标集\n * @returns boolean\n */\nconst checkWhetherHasReachedLeft = coordinates => {\n  let hasReached = false;\n  for (let i = 0; i < coordinates.length; i++) {\n    let { x, y } = coordinates[i];\n    if (x <= 0 || x >= sizeX || y < 0 || y >= sizeY) {\n      hasReached = true;\n      break;\n    }\n\n    if (\n      coordinates.some(coordinate => x - 1 == coordinate.x && y == coordinate.y)\n    )\n      continue;\n\n    if (COORDINATES[y][x - 1] == 1) {\n      hasReached = true;\n      break;\n    }\n  }\n  return hasReached;\n};\n\n/**\n * 检查是否已到达右侧\n * @param {Array<Object<x,y>>} coordinates 坐标集\n * @returns boolean\n */\nconst checkWhetherHasReachedRight = coordinates => {\n  let hasReached = false;\n  for (let i = 0; i < coordinates.length; i++) {\n    let { x, y } = coordinates[i];\n    if (x < 0 || x >= sizeX - 1 || y < 0 || y >= sizeY) {\n      hasReached = true;\n      break;\n    }\n\n    if (\n      coordinates.some(coordinate => x + 1 == coordinate.x && y == coordinate.y)\n    )\n      continue;\n\n    if (COORDINATES[y][x + 1] == 1) {\n      hasReached = true;\n      break;\n    }\n  }\n  return hasReached;\n};\n\n/**\n * 检查是否已到达底部\n * @param {Array<Object<x,y>>} coordinates 坐标集\n * @returns\n */\nconst checkWhetherHasReachedBottom = coordinates => {\n  let hasReached = false;\n  for (let i = 0; i < coordinates.length; i++) {\n    let { x, y } = coordinates[i];\n    if (x < 0 || x >= sizeX || y < 0 || y >= sizeY - 1) {\n      hasReached = true;\n      break;\n    }\n\n    if (\n      coordinates.some(coordinate => x == coordinate.x && y + 1 == coordinate.y)\n    )\n      continue;\n\n    if (COORDINATES[y + 1][x] == 1) {\n      hasReached = true;\n      break;\n    }\n  }\n  return hasReached;\n};\n\n/**\n * 获取已填充满的行坐标\n * @returns Array<integer>\n */\nconst getFilledYCoordinates = () => {\n  let yCoordinates = [];\n  for (let y = sizeY - 1; y >= 0; y--) {\n    if (!COORDINATES[y].some(state => state == 1)) break;\n    if (COORDINATES[y].every(state => state == 1)) {\n      for (let x = 0; x < sizeX; x++) {\n        COORDINATES[y][x] = 0;\n      }\n      yCoordinates.push(y);\n    }\n  }\n  return yCoordinates;\n};\n\n/**\n * 填满若干行之后，重置整个坐标系\n * @param {Array<integer>} yCoordinates 已填满的行坐标\n * @param {function} callback 回调函数\n */\nconst reset = (yCoordinates, callback) => {\n  let inactives = [],\n    actives = [];\n\n  yCoordinates.sort((a, b) => b - a);\n  let y = yCoordinates[0],\n    emptyY = y;\n  while (y >= 0 && y < sizeY) {\n    if (COORDINATES[y].some(state => state == 1)) {\n      inactives = [];\n      actives = [];\n      for (let x = 0; x < sizeX; x++) {\n        if (COORDINATES[y][x] == 1) {\n          COORDINATES[y][x] = 0;\n          inactives.push({ x: x, y: y });\n          COORDINATES[emptyY][x] = 1;\n          actives.push({ x: x, y: emptyY });\n        }\n      }\n\n      emptyY--;\n      if (inactives.length > 0 || actives.length > 0) {\n        callback && callback(inactives, actives);\n      }\n    }\n    y--;\n  }\n};\n\n/**\n * 逐行填满\n */\nconst fillRow = y => {\n  if (y < 0 || y >= sizeY) return [];\n  let coordinates = [];\n  for (let x = 0; x < sizeX; x++) {\n    COORDINATES[y][x] = 1;\n    coordinates.push({ x: x, y: y });\n  }\n  return coordinates;\n};\n\n/**\n * 逐行清空\n */\nconst clearRow = y => {\n  if (y < 0 || y >= sizeY) return [];\n\n  let coordinates = [];\n  for (let x = 0; x < sizeX; x++) {\n    COORDINATES[y][x] = 0;\n    coordinates.push({ x: x, y: y });\n  }\n  return coordinates;\n};\n\nexport default {\n  initialize,\n  update,\n  isAllFilled,\n  checkWhetherHasReachedLeft,\n  checkWhetherHasReachedRight,\n  checkWhetherHasReachedBottom,\n  getFilledYCoordinates,\n  reset,\n  fillRow,\n  clearRow\n};\n","/**\n * @file 启动模块\n * @version 1.0.0\n */\n\nlet containerDOM = document.getElementById(\"container\");\nif (!containerDOM) {\n  throw new Error(\"Cannot find container.\");\n}\n\nimport GamePanel from \"./gamepanel\";\nimport Screen from \"./screen\";\nimport Control from \"./control\";\nimport Engine from \"./engine\";\n\nGamePanel.initialize(containerDOM);\nScreen.initialize(containerDOM, GamePanel.getScreenOptions());\nControl.initialize(containerDOM, GamePanel.getControlOptions());\nlet screenMatrixSize = Screen.getSize();\nEngine.initialize({\n  matrixSizeX: screenMatrixSize.matrixSizeX,\n  matrixSizeY: screenMatrixSize.matrixSizeY,\n  activate: Screen.activate,\n  inactivate: Screen.inactivate,\n  highlight: Screen.highlight,\n  unhighlight: Screen.unhighlight,\n  updateScore: Screen.updateScore,\n  updateEliminatedRowNum: Screen.updateEliminatedRowNum,\n  updateNextShape: Screen.updateNextShape\n});\n\nControl.addDropEventHandler(Engine.onMoveDrop);\nControl.addLeftEventHandler(Engine.onMoveLeft);\nControl.addRightEventHandler(Engine.onMoveRight);\nControl.addDownEventHandler(Engine.onMoveDown);\nControl.addRotateEventHandler(Engine.onMoveRotate);\nControl.addRestartEventHandler(Engine.onGameRestart);\nControl.addPauseEventHandler(Engine.onGamePause);\n\nEngine.start();\n","/**\n * @file 游戏面板模块\n * @version 1.0.0\n */\n\nimport { panel as PANEL_CONFIG } from './config';\nimport Canvas from './canvas';\n\nlet screenOptions = { offsetX: 0, offsetY: 0, width: 0, height: 0 },\n\tcontrolOptions = { offsetX: 0, offsetY: 0, width: 0, height: 0 };\n\n/**\n * 初始化\n * @param {element} containerDOM 容器DOM对象\n */\nconst initialize = (containerDOM) => {\n\tlet width = containerDOM.clientWidth,\n\t\theight = containerDOM.clientHeight;\n\n\tscreenOptions = {\n\t\toffsetX: PANEL_CONFIG.screenMargin,\n\t\toffsetY: PANEL_CONFIG.screenMargin,\n\t\twidth: width - 2 * PANEL_CONFIG.screenMargin,\n\t\theight: height * PANEL_CONFIG.screenHeightProportion - 2 * PANEL_CONFIG.screenMargin\n\t};\n\n\tcontrolOptions = {\n\t\toffsetX: PANEL_CONFIG.controlMargin,\n\t\toffsetY: height * PANEL_CONFIG.screenHeightProportion,\n\t\twidth: width - 2 * PANEL_CONFIG.controlMargin,\n\t\theight: height * (1 - PANEL_CONFIG.screenHeightProportion) - PANEL_CONFIG.controlMargin\n\t};\n\n\tlet canvas = new Canvas(containerDOM, 0, 0, width, height);\n\tcanvas.setStyles([ 'z-index:1;' ]);\n\tcanvas.fillRect(0, 0, width, height, {\n\t\tfillStyle: PANEL_CONFIG.backgroundColor\n\t});\n\n\tcanvas.clearRect(0, 0, 10, 10);\n\tcanvas.fillCircle(10, 10, 10, Math.PI / 2, Math.PI, true);\n\tcanvas.clearRect(width - 10, 0, 10, 10);\n\tcanvas.fillCircle(width - 10, 10, 10, 0, Math.PI / 2, true);\n\tcanvas.clearRect(width - 10, height - 10, 10, 10);\n\tcanvas.fillCircle(width - 10, height - 10, 10, 0, Math.PI * 2, false);\n\tcanvas.clearRect(0, height - 10, 10, 10);\n\tcanvas.fillCircle(10, height - 10, 10, Math.PI, Math.PI * 1.5, true);\n\n\tcanvas.clearRect(screenOptions.offsetX, screenOptions.offsetY, screenOptions.width, screenOptions.height);\n\tcanvas.fillRect(screenOptions.offsetX, screenOptions.offsetY, screenOptions.width, screenOptions.height, {\n\t\tfillStyle: PANEL_CONFIG.screenBackgroundColor\n\t});\n};\n\n/**\n * 获取屏幕选项配置\n * @returns\n */\nconst getScreenOptions = () => {\n\treturn screenOptions;\n};\n\n/**\n * 获取控制板选项配置\n * @returns\n */\nconst getControlOptions = () => {\n\treturn controlOptions;\n};\n\nexport default { initialize, getScreenOptions, getControlOptions };\n","/**\n * @file 屏幕模块\n * @version 1.0.0\n */\n\nimport { screen as SCREEN_CONFIG, matrix as MATRIX_CONFIG } from \"../config\";\nimport Matrix from \"./matrix\";\nimport State from \"./state\";\n\nlet paddingX = 0,\n  paddingY = 0,\n  horizontalBlockNumber = 0,\n  verticalBlockNumber = 0,\n  matrixWidthProportion = 0.7;\n\n/**\n * 初始化\n * @param {element} containerDOM 容器DOM对象\n * @param {object} { offsetX, offsetY, width, height }\n */\nconst initialize = (containerDOM, { offsetX, offsetY, width, height }) => {\n  width = width - 4 * MATRIX_CONFIG.borderWidth - 2 * SCREEN_CONFIG.padding;\n  height = height - 4 * MATRIX_CONFIG.borderWidth - 2 * SCREEN_CONFIG.padding;\n  horizontalBlockNumber = Math.floor(width / MATRIX_CONFIG.blockSize);\n  verticalBlockNumber = Math.floor(height / MATRIX_CONFIG.blockSize);\n  if (width % MATRIX_CONFIG.blockSize == 0) {\n    horizontalBlockNumber--;\n    paddingX = MATRIX_CONFIG.blockSize / 2;\n  } else {\n    paddingX = (width - horizontalBlockNumber * MATRIX_CONFIG.blockSize) / 2;\n  }\n  if (height % MATRIX_CONFIG.blockSize == 0) {\n    verticalBlockNumber--;\n    paddingY = MATRIX_CONFIG.blockSize / 2;\n  } else {\n    paddingY = (height - verticalBlockNumber * MATRIX_CONFIG.blockSize) / 2;\n  }\n\n  offsetX = offsetX + paddingX + SCREEN_CONFIG.padding;\n  offsetY = offsetY + paddingY + SCREEN_CONFIG.padding;\n  horizontalBlockNumber = Math.floor(\n    horizontalBlockNumber * matrixWidthProportion\n  );\n\n  let matrixWidth =\n      MATRIX_CONFIG.blockSize * horizontalBlockNumber +\n      2 * MATRIX_CONFIG.borderWidth,\n    matrixHeight =\n      MATRIX_CONFIG.blockSize * verticalBlockNumber +\n      2 * MATRIX_CONFIG.borderWidth;\n\n  Matrix.initialize(\n    containerDOM,\n    offsetX,\n    offsetY,\n    matrixWidth,\n    matrixHeight,\n    horizontalBlockNumber,\n    verticalBlockNumber\n  );\n\n  State.initialize(\n    containerDOM,\n    offsetX + matrixWidth,\n    offsetY,\n    width - 2 * paddingX - matrixWidth,\n    height - 2 * paddingY\n  );\n};\n\n/**\n * 获取屏幕矩阵尺寸\n * @returns\n */\nconst getSize = () => {\n  return {\n    matrixSizeX: horizontalBlockNumber,\n    matrixSizeY: verticalBlockNumber\n  };\n};\n\nexport default {\n  initialize,\n  getSize,\n  activate: Matrix.activate,\n  inactivate: Matrix.inactivate,\n  highlight: Matrix.highlight,\n  unhighlight: Matrix.unhighlight,\n  updateScore: State.updateScore,\n  updateEliminatedRowNum: State.updateEliminatedRowNum,\n  updateNextShape: State.updateNextShape\n};\n","/**\n * @file 屏幕矩阵模块\n * @version 1.0.0\n */\n\nimport { matrix as MATRIX_CONFIG } from \"../config\";\nimport Canvas from \"../canvas\";\nimport Block from \"./block\";\n\nlet bgCanvas = null,\n  canvas = null,\n  horizontalSize = 0,\n  verticalSize = 0;\n\nconst BLOCKS_MAP = {},\n  getBlockKey = (x, y) => {\n    return `KEY_${x}_${y}`;\n  };\n\nconst initialize = (\n  containerDOM,\n  offsetX,\n  offsetY,\n  width,\n  height,\n  horizontalBlockNumber,\n  verticalBlockNumber\n) => {\n  horizontalSize = horizontalBlockNumber;\n  verticalSize = verticalBlockNumber;\n\n  bgCanvas = new Canvas(\n    containerDOM,\n    offsetX,\n    offsetY,\n    width,\n    height,\n    \"Matrix Background Canvas\"\n  );\n  bgCanvas.setStyles([\"z-index:2;\"]);\n\n  canvas = new Canvas(\n    containerDOM,\n    offsetX,\n    offsetY,\n    width,\n    height,\n    \"Matrix Main Canvas\"\n  );\n  canvas.setStyles([\"z-index:3;\"]);\n\n  for (let i = 0; i < horizontalSize; i++) {\n    for (let j = 0; j < verticalSize; j++) {\n      let block = new Block(\n        bgCanvas,\n        i * MATRIX_CONFIG.blockSize + MATRIX_CONFIG.borderWidth,\n        j * MATRIX_CONFIG.blockSize + MATRIX_CONFIG.borderWidth,\n        MATRIX_CONFIG.blockSize\n      );\n      block.activate(\n        { strokeStyle: MATRIX_CONFIG.bgBlockBorderColor },\n        { fillStyle: MATRIX_CONFIG.bgBlockBackgroundColor }\n      );\n      block.canvas = canvas;\n      block.isActive = false;\n      BLOCKS_MAP[getBlockKey(i, j)] = block;\n    }\n  }\n\n  canvas.strokeRect(0, 0, width, height, {\n    lineWidth: MATRIX_CONFIG.borderWidth\n  });\n};\n\nconst activate = coordinates => {\n  if (!Array.isArray(coordinates)) return;\n  coordinates.forEach(({ x, y }) => {\n    let block = BLOCKS_MAP[getBlockKey(x, y)];\n    block &&\n      block.activate(\n        { strokeStyle: MATRIX_CONFIG.blockBorderColor },\n        { fillStyle: MATRIX_CONFIG.blockBackgroundColor }\n      );\n  });\n};\n\nconst inactivate = coordinates => {\n  if (!Array.isArray(coordinates)) return;\n  coordinates.forEach(({ x, y }) => {\n    let block = BLOCKS_MAP[getBlockKey(x, y)];\n    block && block.inactivate();\n  });\n};\n\nconst highlight = yCoordinates => {\n  if (!Array.isArray(yCoordinates) || yCoordinates.length == 0) return;\n\n  yCoordinates.forEach(y => {\n    if (!Number.isNaN(y) && y >= 0 && y < verticalSize) {\n      for (let i = 0; i < horizontalSize; i++) {\n        let block = BLOCKS_MAP[getBlockKey(i, y)];\n        if (!block) continue;\n        block.activate(\n          { strokeStyle: MATRIX_CONFIG.highlightBlockBorderColor },\n          { fillStyle: MATRIX_CONFIG.highlightBlockBackgroundColor }\n        );\n      }\n    }\n  });\n};\n\nconst unhighlight = yCoordinates => {\n  if (!Array.isArray(yCoordinates) || yCoordinates.length == 0) return;\n\n  yCoordinates.forEach(y => {\n    if (!Number.isNaN(y) && y >= 0 && y < verticalSize) {\n      for (let i = 0; i < horizontalSize; i++) {\n        let block = BLOCKS_MAP[getBlockKey(i, y)];\n        if (!block) continue;\n        block.inactivate();\n      }\n    }\n  });\n};\n\nexport default {\n  initialize,\n  activate,\n  inactivate,\n  highlight,\n  unhighlight\n};\n","/**\n * @file 屏幕状态模块\n * @version 1.0.0\n */\n\nimport { state as STATE_CONFIG, matrix as MATRIX_CONFIG } from \"../config\";\nimport Canvas from \"../canvas\";\nimport Block from \"./block\";\nimport DigitSequence from \"./digitsequence\";\n\nlet bgCanvas = null,\n  canvas = null,\n  scoreDigitSequence = null,\n  eliminatedRowsDigitSequence = null;\n\nconst BLOCKS_MAP = {},\n  getBlockKey = (x, y) => {\n    return `KEY_${x}_${y}`;\n  };\n\nconst initialize = (containerDOM, offsetX, offsetY, width, height) => {\n  bgCanvas = new Canvas(\n    containerDOM,\n    offsetX,\n    offsetY,\n    width,\n    height,\n    \"State Background Canvas\"\n  );\n  bgCanvas.setStyles([\"z-index:2;\"]);\n\n  canvas = new Canvas(\n    containerDOM,\n    offsetX,\n    offsetY,\n    width,\n    height,\n    \"State Main Canvas\"\n  );\n  canvas.setStyles([\"z-index:3;\"]);\n\n  width -= STATE_CONFIG.left;\n  height -= STATE_CONFIG.top;\n  let scoreHeight = height * 0.3,\n    eliminatedRowsHeight = height * 0.3,\n    nextBlockHeight = height * 0.4,\n    scoreOffsetX = STATE_CONFIG.left,\n    scoreOffsetY = STATE_CONFIG.top,\n    eliminatedRowsOffsetX = STATE_CONFIG.left,\n    eliminatedRowsOffsetY = STATE_CONFIG.top + scoreHeight,\n    nextShapeOffsetX = STATE_CONFIG.left,\n    nextShapeOffsetY = STATE_CONFIG.top + scoreHeight + eliminatedRowsHeight;\n\n  let digitSequenceOffset = 5;\n  canvas.context.font = STATE_CONFIG.font;\n  canvas.fillText(\"得分\", scoreOffsetX, scoreOffsetY);\n  scoreDigitSequence = new DigitSequence(\n    bgCanvas,\n    canvas,\n    scoreOffsetX + digitSequenceOffset,\n    scoreOffsetY + STATE_CONFIG.fontSize,\n    width - digitSequenceOffset\n  );\n\n  canvas.fillText(\"消除行\", eliminatedRowsOffsetX, eliminatedRowsOffsetY);\n  eliminatedRowsDigitSequence = new DigitSequence(\n    bgCanvas,\n    canvas,\n    eliminatedRowsOffsetX + digitSequenceOffset,\n    eliminatedRowsOffsetY + STATE_CONFIG.fontSize,\n    width - digitSequenceOffset\n  );\n\n  canvas.fillText(\"下一个\", nextShapeOffsetX, nextShapeOffsetY);\n  let matrixOffsetX = nextShapeOffsetX,\n    matrixOffsetY = nextShapeOffsetY + STATE_CONFIG.fontSize;\n  for (let i = 0; i < 4; i++) {\n    for (let j = 0; j < 2; j++) {\n      let block = new Block(\n        bgCanvas,\n        matrixOffsetX + i * MATRIX_CONFIG.blockSize,\n        matrixOffsetY + j * MATRIX_CONFIG.blockSize,\n        MATRIX_CONFIG.blockSize\n      );\n      block.activate(\n        { strokeStyle: MATRIX_CONFIG.bgBlockBorderColor },\n        { fillStyle: MATRIX_CONFIG.bgBlockBackgroundColor }\n      );\n      block.canvas = canvas;\n      block.isActive = false;\n      BLOCKS_MAP[getBlockKey(i, j)] = block;\n    }\n  }\n};\n\nconst updateScore = score => {\n  score = Number.parseInt(score);\n  score > 0 ? scoreDigitSequence.show(score) : scoreDigitSequence.reset();\n};\n\nconst updateEliminatedRowNum = rowNum => {\n  rowNum = Number.parseInt(rowNum);\n  rowNum > 0\n    ? eliminatedRowsDigitSequence.show(rowNum)\n    : eliminatedRowsDigitSequence.reset();\n};\n\nconst updateNextShape = coordinates => {\n  if (!Array.isArray(coordinates)) return;\n  for (let key in BLOCKS_MAP) {\n    BLOCKS_MAP[key].inactivate();\n  }\n  if (coordinates.length == 0) return;\n  coordinates.forEach(coordinate => {\n    let block = BLOCKS_MAP[getBlockKey(coordinate.x, coordinate.y)];\n    block &&\n      block.activate(\n        { strokeStyle: MATRIX_CONFIG.blockBorderColor },\n        { fillStyle: MATRIX_CONFIG.blockBackgroundColor }\n      );\n  });\n};\n\nexport default {\n  initialize,\n  updateScore,\n  updateEliminatedRowNum,\n  updateNextShape\n};\n","import Digit from \"./digit\";\n\n/**\n * 数字序列类\n * @export DigitSequence\n * @class DigitSequence\n */\nexport default class DigitSequence {\n  constructor(bgCanvas, canvas, x, y, width) {\n    this.x = x;\n    this.y = y;\n    this.width = width;\n\n    this.min = 0;\n    this.max = 999999;\n    this.digitList = [];\n    this.digitNumber = 6;\n    this.digitSpanProportion = 0.4;\n    this.size =\n      this.width / (this.digitNumber + (this.digitNumber - 1) * this.digitSpanProportion);\n\n    for (let i = this.digitNumber - 1; i >= 0; i--) {\n      this.digitList.push(\n        new Digit(\n          this.x + i * this.size + i * this.digitSpanProportion * this.size,\n          this.y,\n          this.size,\n          bgCanvas,\n          canvas\n        )\n      );\n    }\n\n    this.show = this.show.bind(this);\n    this.reset = this.reset.bind(this);\n  }\n\n  show(value) {\n    if (!Number.isInteger(value))\n      throw new Error(\"The value should be an integer.\");\n    if (value < this.min || value > this.max)\n      throw new Error(`The value should between ${this.min} and ${this.max}.`);\n\n    this.reset();\n    let valueStr = value.toString();\n    for (let i = 0; i < valueStr.length; i++) {\n      i < this.digitNumber &&\n        this.digitList[i].show(valueStr.charAt(valueStr.length - 1 - i));\n    }\n  }\n\n  reset() {\n    this.digitList.forEach(d => d.hide());\n  }\n}\n","const showDigit = function(canvas, d, fillStyle) {\n  if (![1, 4].includes(d.digit)) {\n    d.canvas.fillHalfEllipse(\n      d.x + d.size / 2,\n      d.y,\n      d.radius,\n      true,\n      false,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if (![5, 6].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x + d.size,\n      d.y + d.size / 2,\n      d.radius,\n      false,\n      false,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if (![2].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x + d.size,\n      d.y + d.size * 1.5,\n      d.radius,\n      false,\n      false,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if (![1, 4, 7].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x + d.size / 2,\n      d.y + d.size * 2,\n      d.radius,\n      true,\n      true,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if ([0, 2, 6, 8].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x,\n      d.y + d.size * 1.5,\n      d.radius,\n      false,\n      true,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if (![0, 1, 7].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x + d.size / 2,\n      d.y + d.size,\n      d.radius,\n      true,\n      false,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n\n  if (![1, 2, 3, 7].includes(d.digit)) {\n    canvas.fillHalfEllipse(\n      d.x,\n      d.y + d.size / 2,\n      d.radius,\n      false,\n      true,\n      d.scale,\n      { fillStyle: fillStyle }\n    );\n  }\n};\n\n/**\n * 数字类\n * @export Digit\n * @class Digit\n */\nexport default class Digit {\n  constructor(x, y, size, bgCanvs, canvas) {\n    if (!bgCanvs || !canvas)\n      throw new Error(\n        \"The digit backgroundCanvas and canvas should not be null.\"\n      );\n\n    this.x = x;\n    this.y = y;\n    this.size = size;\n    this.scale = 0.4;\n    this.radius = this.size / 2 - 1;\n    this.scaleRadius = this.scale * this.radius;\n    this.digit = 8;\n    this.bgCanvas = bgCanvs;\n    this.canvas = canvas;\n\n    this.show = this.show.bind(this);\n    this.hide = this.hide.bind(this);\n\n    this.hide();\n  }\n\n  show(digit) {\n    digit = Number.parseInt(digit);\n    if (!Number.isInteger(digit) || digit < 0 || digit > 9) return;\n    this.digit = digit;\n    this.bgCanvas.clearRect(\n      this.x - this.scaleRadius,\n      this.y - this.scaleRadius,\n      this.size + 2 * this.scaleRadius,\n      this.size * 2 + 2 * this.scaleRadius\n    );\n    this.canvas.clearRect(\n      this.x - this.scaleRadius,\n      this.y - this.scaleRadius,\n      this.size + 2 * this.scaleRadius,\n      this.size * 2 + 2 * this.scaleRadius\n    );\n    showDigit(this.canvas, this);\n  }\n\n  hide() {\n    this.digit = 8;\n    this.bgCanvas.clearRect(\n      this.x - this.scaleRadius,\n      this.y - this.scaleRadius,\n      this.size + 2 * this.scaleRadius,\n      this.size * 2 + 2 * this.scaleRadius\n    );\n    this.canvas.clearRect(\n      this.x - this.scaleRadius,\n      this.y - this.scaleRadius,\n      this.size + 2 * this.scaleRadius,\n      this.size * 2 + 2 * this.scaleRadius\n    );\n    showDigit(this.bgCanvas, this, \"#84946e\");\n  }\n}\n","/**\n * @file 控制板模块\n * @version 1.0.0\n */\n\nimport { control as CONTROL_CONFIG } from '../config';\nimport Canvas from '../canvas';\nimport Button from './button';\n\nlet canvas = null;\nconst BUTTONS_MAP = {},\n\tBUTTONS_EVENTHANDLERS_MAP = new Map();\n\n/**\n * 初始化\n * @param {Element} containerDOM 容器DOM对象\n * @param {Object} { offsetX, offsetY, width, height } {偏移X，偏移Y，宽，高}\n */\nconst initialize = (containerDOM, { offsetX, offsetY, width, height }) => {\n\tcanvas = new Canvas(containerDOM, offsetX, offsetY, width, height, '控制器主画布');\n\tcanvas.setStyles([ 'z-index:3;' ]);\n\n\tlet radius = (height - 2 * CONTROL_CONFIG.padding) / 6;\n\tBUTTONS_MAP['DROP'] = new Button(\n\t\tcanvas,\n\t\tCONTROL_CONFIG.padding + 2 * radius,\n\t\tCONTROL_CONFIG.padding,\n\t\tradius,\n\t\t'掉落',\n\t\t'Drop Button'\n\t);\n\tBUTTONS_MAP['LEFT'] = new Button(\n\t\tcanvas,\n\t\tCONTROL_CONFIG.padding,\n\t\tCONTROL_CONFIG.padding + 2 * radius,\n\t\tradius,\n\t\t'左移',\n\t\t'Left Button'\n\t);\n\tBUTTONS_MAP['RIGHT'] = new Button(\n\t\tcanvas,\n\t\tCONTROL_CONFIG.padding + 4 * radius,\n\t\tCONTROL_CONFIG.padding + 2 * radius,\n\t\tradius,\n\t\t'右移',\n\t\t'Right Button'\n\t);\n\tBUTTONS_MAP['DOWN'] = new Button(\n\t\tcanvas,\n\t\tCONTROL_CONFIG.padding + 2 * radius,\n\t\tCONTROL_CONFIG.padding + 4 * radius,\n\t\tradius,\n\t\t'下移',\n\t\t'Drop Button'\n\t);\n\tBUTTONS_MAP['ROTATE'] = new Button(\n\t\tcanvas,\n\t\twidth - CONTROL_CONFIG.padding - 4 * radius,\n\t\theight - CONTROL_CONFIG.padding - 5 * radius,\n\t\tradius * 2,\n\t\t'旋转',\n\t\t'Rotate Button'\n\t);\n\tBUTTONS_MAP['RESTART'] = new Button(\n\t\tcanvas,\n\t\twidth - CONTROL_CONFIG.padding - 5.5 * radius,\n\t\tCONTROL_CONFIG.padding,\n\t\tradius * 0.8,\n\t\t'重启',\n\t\t'Restart Button',\n\t\t{\n\t\t\tshowShadow: false,\n\t\t\tstopColor1: 'darkgreen',\n\t\t\tstopColor2: 'darkgreen'\n\t\t}\n\t);\n\tBUTTONS_MAP['PAUSE'] = new Button(\n\t\tcanvas,\n\t\twidth - CONTROL_CONFIG.padding - 7.5 * radius,\n\t\tCONTROL_CONFIG.padding,\n\t\tradius * 0.8,\n\t\t'暂停',\n\t\t'Pause Button',\n\t\t{\n\t\t\tshowShadow: false,\n\t\t\tstopColor1: 'darkgreen',\n\t\t\tstopColor2: 'darkgreen'\n\t\t}\n\t);\n\n\tlet { controlPageX, controlPageY } = getControlOffsetAgainstPage();\n\tcanvas.canvas.onclick = function(e) {\n\t\tlet eventName = '',\n\t\t\tclickX = e.pageX - controlPageX,\n\t\t\tclickY = e.pageY - controlPageY;\n\t\tfor (let name in BUTTONS_MAP) {\n\t\t\tif (BUTTONS_MAP[name].contains(clickX, clickY)) {\n\t\t\t\teventName = name;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\teventName && executeEventHandler(eventName);\n\t};\n\n\tdocument.onkeydown = function(e) {\n\t\tswitch (e.keyCode) {\n\t\t\tcase 32:\n\t\t\t\texecuteEventHandler('DROP');\n\t\t\t\tbreak;\n\t\t\tcase 37:\n\t\t\t\texecuteEventHandler('LEFT');\n\t\t\t\tbreak;\n\t\t\tcase 38:\n\t\t\t\texecuteEventHandler('ROTATE');\n\t\t\t\tbreak;\n\t\t\tcase 39:\n\t\t\t\texecuteEventHandler('RIGHT');\n\t\t\t\tbreak;\n\t\t\tcase 40:\n\t\t\t\texecuteEventHandler('DOWN');\n\t\t\t\tbreak;\n\t\t\tcase 80:\n\t\t\t\texecuteEventHandler('PAUSE');\n\t\t\t\tbreak;\n\t\t\tcase 82:\n\t\t\t\texecuteEventHandler('RESTART');\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t};\n};\n\n/**\n * 获取控件板相对于页面的偏移坐标\n * @returns\n */\nconst getControlOffsetAgainstPage = () => {\n\tif (!canvas) return { offsetX: 0, offsetY: 0 };\n\tlet x = 0,\n\t\ty = 0,\n\t\te = canvas.canvas;\n\twhile (e !== null) {\n\t\tx += e.offsetLeft;\n\t\ty += e.offsetTop;\n\t\te = e.offsetParent;\n\t}\n\treturn { controlPageX: x, controlPageY: y };\n};\n\n/**\n * 添加事件处理程序*\n * @param {string} eventName 事件名称\n * @param {function} handler 处理器\n */\nconst addEventHandler = (eventName, handler) => {\n\tif (handler && typeof handler == 'function') {\n\t\tlet handlers = BUTTONS_EVENTHANDLERS_MAP.get(eventName);\n\t\tif (!handlers) handlers = [];\n\t\thandlers.push(handler);\n\t\tBUTTONS_EVENTHANDLERS_MAP.set(eventName, handlers);\n\t}\n};\n\n/**\n * 执行事件处理程序\n * @param {string} eventName 事件名称\n * @returns\n */\nconst executeEventHandler = (eventName) => {\n\tlet handlers = BUTTONS_EVENTHANDLERS_MAP.get(eventName);\n\tif (!handlers || handlers.length == 0) return;\n\tfor (let handler of handlers) {\n\t\thandler && handler();\n\t}\n};\n\n/**\n * 添加掉落事件处理程序\n * @param {function} handler 处理器\n */\nconst addDropEventHandler = (handler) => {\n\taddEventHandler('DROP', handler);\n};\n\n/**\n * 添加左移事件处理程序\n * @param {function} handler 处理器\n */\nconst addLeftEventHandler = (handler) => {\n\taddEventHandler('LEFT', handler);\n};\n\n/**\n * 添加右移事件处理程序\n * @param {function} handler 处理器\n */\nconst addRightEventHandler = (handler) => {\n\taddEventHandler('RIGHT', handler);\n};\n\n/**\n * 添加下移事件处理程序\n * @param {function} handler 处理器\n */\nconst addDownEventHandler = (handler) => {\n\taddEventHandler('DOWN', handler);\n};\n\n/**\n * 添加旋转事件处理程序\n * @param {function} handler 处理器\n */\nconst addRotateEventHandler = (handler) => {\n\taddEventHandler('ROTATE', handler);\n};\n\n/**\n * 添加重启事件处理程序\n * @param {function} handler 处理器\n */\nconst addRestartEventHandler = (handler) => {\n\taddEventHandler('RESTART', handler);\n};\n\n/**\n * 添加暂停事件处理程序\n * @param {function} handler 处理器\n */\nconst addPauseEventHandler = (handler) => {\n\taddEventHandler('PAUSE', handler);\n};\n\nexport default {\n\tinitialize,\n\taddDropEventHandler,\n\taddLeftEventHandler,\n\taddRightEventHandler,\n\taddDownEventHandler,\n\taddRotateEventHandler,\n\taddRestartEventHandler,\n\taddPauseEventHandler\n};\n","/**\n * 控制板按钮类\n * @export Button\n * @class Button\n */\nexport default class Button {\n  constructor(\n    canvas,\n    x,\n    y,\n    radius,\n    text,\n    name = \"未命名按钮\",\n    options = { showShadow: true }\n  ) {\n    this.canvas = canvas;\n    this.x = x;\n    this.y = y;\n    this.radius = radius;\n    this.sx = this.x + this.radius;\n    this.sy = this.y + this.radius;\n    this.text = text;\n    this.name = name;\n\n    let gradient = canvas.getLinearGradient(\n      this.x + this.radius * 2,\n      this.y,\n      this.x,\n      this.y + this.radius * 2,\n      [\n        { position: 0, color: options.stopColor1 || \"#343434\" },\n        { position: 1, color: options.stopColor2 || \"black\" }\n      ]\n    );\n    canvas.fillCircle(this.sx, this.sy, this.radius, 0, Math.PI * 2, false, {\n      fillStyle: gradient,\n      shadowOffsetX: options.showShadow ? -4 : 0,\n      shadowOffsetY: options.showShadow ? 4 : 0,\n      shadowBlur: options.showShadow ? 2 : 0,\n      shadowColor: options.shadownColor || \"rgb(0,0,0,0.5)\"\n    });\n\n    if (this.text) {\n      let textWidth = this.canvas.measureText(this.text),\n        fontSize = this.radius * 0.5;\n      fontSize = fontSize < 10 ? 10 : fontSize;\n      this.canvas.fillText(text, this.sx, this.sy + fontSize / 4, {\n        font: `${fontSize}px Arial`,\n        fillStyle: \"white\",\n        textAlign: \"center\",\n        textBaseLine: \"hanging\"\n      });\n    }\n\n    this.contains = this.contains.bind(this);\n  }\n\n  /**\n   * 是否包含该坐标\n   *\n   * @param {number} x 坐标x\n   * @param {number} y 坐标y\n   * @returns\n   * @memberof Button\n   */\n  contains(x, y) {\n    return (\n      Math.sqrt(Math.pow(x - this.sx, 2) + Math.pow(y - this.sy, 2)) <=\n      this.radius\n    );\n  }\n}\n","/**\n * @file 引擎模块\n * @version 1.0.0\n */\n\nimport { extend, getScore } from '../util';\nimport DB from './db';\nimport TIMER from './timer';\nimport BUILDER from './builder';\nimport ANIMATION from './animation';\n\nconst INTERVAL = 500,\n\tSHAPES = [],\n\tSCREEN = {\n\t\tmatrixSizeX: 0,\n\t\tmatrixSizeY: 0,\n\t\tactivate: function() {},\n\t\tinactivate: function() {},\n\t\thighlight: function() {},\n\t\tunhighlight: function() {},\n\t\tupdateScore: function() {},\n\t\tupdateEliminatedRowNum: function() {},\n\t\tupdateNextShape: function() {}\n\t};\n\nlet elapsingObject = {\n\tshape: null,\n\ttotalScore: 0,\n\teliminatedRowNum: 0,\n\tisHighlightAnimating: false,\n\tisPaused: false,\n\tclear() {\n\t\telapsingObject.isPaused = false;\n\t\telapsingObject.shape = null;\n\t\telapsingObject.totalScore = 0;\n\t\telapsingObject.eliminatedRowNum = 0;\n\t\telapsingObject.isHighlightAnimating = false;\n\t}\n};\n\n/**\n * 初始化\n * @param {object} screenOptions 屏幕配置选项\n */\nconst initialize = (screenOptions) => {\n\textend(SCREEN, screenOptions);\n\n\tDB.initialize(SCREEN.matrixSizeX, SCREEN.matrixSizeY);\n\tTIMER.initialize(INTERVAL, onTimerElapsed);\n\tANIMATION.initialize(screenOptions);\n};\n\n/**\n * 当定时器经过一个单位的间隔时间后的处理程序\n * @returns\n */\nconst onTimerElapsed = () => {\n\tif (elapsingObject.isHighlightAnimating) return;\n\n\twhile (SHAPES.length < 2) {\n\t\tSHAPES.push(BUILDER.getShape(SCREEN.matrixSizeX));\n\t}\n\n\tif (!elapsingObject.shape) {\n\t\telapsingObject.shape = SHAPES.shift();\n\t\tSCREEN.updateNextShape(SHAPES[0].getRawCoordinates());\n\t}\n\n\telapsingObject.shape.down();\n\n\treturn onShapeMoved();\n};\n\n/**\n * 当图形发生移动时的处理程序\n * @returns\n */\nconst onShapeMoved = () => {\n\tif (!elapsingObject.shape) return;\n\n\tDB.update(elapsingObject.shape.prevCoordinates, elapsingObject.shape.coordinates);\n\tSCREEN.inactivate(elapsingObject.shape.prevCoordinates);\n\tSCREEN.activate(elapsingObject.shape.coordinates);\n\n\tif (DB.checkWhetherHasReachedBottom(elapsingObject.shape.coordinates)) {\n\t\tonRowsFilled(DB.getFilledYCoordinates());\n\t\telapsingObject.shape = null;\n\t}\n};\n\n/**\n * 当有若干行被填满时的处理程序\n * @param {Array<integer>} yCoordinates 行的Y轴坐标集合\n * @returns\n */\nconst onRowsFilled = (yCoordinates) => {\n\tif (!yCoordinates || yCoordinates.length == 0) {\n\t\tif (DB.isAllFilled()) {\n\t\t\tconsole.log(\n\t\t\t\t`You lost game at ${new Date().toLocaleString()}, and you got ${elapsingObject.totalScore} in score while you had eliminated ${elapsingObject.eliminatedRowNum} rows.`\n\t\t\t);\n\t\t\tstop();\n\n\t\t\tSCREEN.updateScore(0);\n\t\t\tSCREEN.updateEliminatedRowNum(0);\n\t\t\tSCREEN.updateNextShape([]);\n\n      \t\t// 开启清屏动画，然后再次启动引擎\n\t\t\tANIMATION.fillScreen(() => {\n\t\t\t\tANIMATION.clearScreen(start);\n\t\t\t});\n\t\t}\n\t\treturn;\n\t}\n\n\telapsingObject.isHighlightAnimating = true;\n\tANIMATION.highlight(yCoordinates, 5, () => {\n\t\telapsingObject.totalScore += getScore(yCoordinates);\n\t\tSCREEN.updateScore(elapsingObject.totalScore);\n\t\telapsingObject.eliminatedRowNum += yCoordinates.length;\n\t\tSCREEN.updateEliminatedRowNum(elapsingObject.eliminatedRowNum);\n\n\t\tDB.reset(yCoordinates, (inactives, actives) => {\n\t\t\tSCREEN.inactivate(inactives);\n\t\t\tSCREEN.activate(actives);\n\t\t});\n\t\telapsingObject.isHighlightAnimating = false;\n\n\t\tonRowsFilled(DB.getFilledYCoordinates());\n\t});\n};\n\n/**\n * 启动引擎\n */\nconst start = () => {\n\tTIMER.start();\n};\n\n/**\n * 停止引擎\n *\n */\nconst stop = () => {\n\tTIMER.stop();\n\telapsingObject.clear();\n};\n\n/**\n * 当收到左移指令时\n * @returns\n */\nconst onMoveLeft = () => {\n\telapsingObject.isPaused && onGameRestart();\n\tif (elapsingObject.shape && DB.checkWhetherHasReachedLeft(elapsingObject.shape.coordinates)) return;\n\tif (elapsingObject.shape) {\n\t\telapsingObject.shape.left();\n\t\treturn onShapeMoved();\n\t}\n};\n\n/**\n * 当收到右移指令时\n * @returns\n */\nconst onMoveRight = () => {\n\telapsingObject.isPaused && onGameRestart();\n\tif (elapsingObject.shape && DB.checkWhetherHasReachedRight(elapsingObject.shape.coordinates)) return;\n\tif (elapsingObject.shape) {\n\t\telapsingObject.shape.right();\n\t\treturn onShapeMoved();\n\t}\n};\n\n/**\n * 当收到下移指令时\n * @returns\n */\nconst onMoveDown = () => {\n\telapsingObject.isPaused && onGameRestart();\n\tif (elapsingObject.shape && DB.checkWhetherHasReachedBottom(elapsingObject.shape.coordinates)) return;\n\tif (elapsingObject.shape) {\n\t\telapsingObject.shape.down();\n\t\treturn onShapeMoved();\n\t}\n};\n\n/**\n * 当收到掉落指令时\n * @returns\n */\nconst onMoveDrop = () => {\n\telapsingObject.isPaused && onGameRestart();\n\twhile (elapsingObject.shape) {\n\t\telapsingObject.shape.down();\n\t\tonShapeMoved();\n\t}\n};\n\n/**\n * 当收到旋转指令时\n * @returns\n */\nconst onMoveRotate = () => {\n\telapsingObject.isPaused && onGameRestart();\n\tif (elapsingObject.shape && DB.checkWhetherHasReachedBottom(elapsingObject.shape.coordinates)) return;\n\tif (elapsingObject.shape) {\n\t\telapsingObject.shape.rotate();\n\t\treturn onShapeMoved();\n\t}\n};\n\n/**\n * 当收到暂停指令时\n * @returns\n */\nconst onGamePause = () => {\n\telapsingObject.isPaused = true;\n\tTIMER.pause();\n};\n\n/**\n * 当收到重启指令时\n * @returns\n */\nconst onGameRestart = () => {\n\telapsingObject.isPaused = false;\n\tTIMER.resume();\n};\n\nexport default {\n\tinitialize,\n\tstart,\n\tonMoveLeft,\n\tonMoveRight,\n\tonMoveDown,\n\tonMoveDrop,\n\tonMoveRotate,\n\tonGamePause,\n\tonGameRestart\n};\n","/**\n * @file 定时器模块\n * @version 1.0.0\n */\n\nlet options = {\n    inetrval: 0,\n    handler: null\n  },\n  isPaused = false,\n  timerID = -1;\n\n/**\n * 初始化\n * @param {integer} interval 定时时间\n * @param {function} handler 定时器处理器\n */\nconst initialize = (interval, handler) => {\n  options.interval = interval;\n  options.handler = handler;\n};\n\n/**\n * 启动\n */\nconst start = () => {\n  stop();\n  timerID = setInterval(() => {\n    !isPaused && options.handler && options.handler();\n  }, options.interval);\n};\n\n/**\n * 暂停\n */\nconst pause = () => {\n  isPaused = true;\n};\n\n/**\n * 继续\n */\nconst resume = () => {\n  isPaused = false;\n};\n\n/**\n * 停止\n */\nconst stop = () => {\n  isPaused = false;\n  timerID && clearInterval(timerID);\n};\n\nexport default {\n  initialize,\n  start,\n  pause,\n  resume,\n  stop\n};\n","/**\n * @file 形状生成器模块\n * @version 1.0.0\n */\n\nimport Shape from \"./shape\";\n\n/**\n * 田字型方块\n */\nconst SquareShape = [\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 1, y: 1 }, { x: 0, y: 1 }]\n];\n\n/**\n * L字型方块\n */\nconst LShape = [\n  [{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }, { x: 2, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 2, y: 0 }, { x: 2, y: 1 }],\n  [{ x: 1, y: 0 }, { x: 1, y: 1 }, { x: 1, y: 2 }, { x: 0, y: 2 }]\n];\n\n/**\n * 反L型方块\n */\nconst ReverseLShape = [\n  [{ x: 2, y: 0 }, { x: 2, y: 1 }, { x: 1, y: 1 }, { x: 0, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 1, y: 2 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 2, y: 0 }, { x: 0, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 1, y: 1 }, { x: 1, y: 2 }]\n];\n\n/**\n * 山字型方块\n */\nconst MoutainShape = [\n  [{ x: 1, y: 0 }, { x: 2, y: 1 }, { x: 1, y: 1 }, { x: 0, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 1 }, { x: 0, y: 2 }, { x: 0, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 2, y: 0 }, { x: 1, y: 1 }],\n  [{ x: 1, y: 0 }, { x: 1, y: 1 }, { x: 1, y: 2 }, { x: 0, y: 1 }]\n];\n\n/**\n * 直线型方块\n */\nconst LineShape = [\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 2, y: 0 }, { x: 3, y: 0 }],\n  [{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 0, y: 2 }, { x: 0, y: 3 }]\n];\n\n/**\n * 小H型方块\n */\nconst LittleHShape = [\n  [{ x: 0, y: 0 }, { x: 1, y: 0 }, { x: 1, y: 1 }, { x: 2, y: 1 }],\n  [{ x: 1, y: 0 }, { x: 1, y: 1 }, { x: 0, y: 1 }, { x: 0, y: 2 }]\n];\n\n/**\n * 反小H型方块\n */\nconst ReverseLittleHShape = [\n  [{ x: 1, y: 0 }, { x: 2, y: 0 }, { x: 1, y: 1 }, { x: 0, y: 1 }],\n  [{ x: 0, y: 0 }, { x: 0, y: 1 }, { x: 1, y: 1 }, { x: 1, y: 2 }]\n];\n\n/**\n * 生成一个图形\n * @returns {object} 一个模块图形\n */\nconst getShape = sizeX => {\n  let shapes = [\n    SquareShape,\n    LShape,\n    ReverseLShape,\n    MoutainShape,\n    LineShape,\n    LittleHShape,\n    ReverseLittleHShape\n  ];\n  let rand = Math.floor(Math.random() * shapes.length),\n    offsetX = 0,\n    offsetY = 0;\n  let shape = shapes[rand];\n  for (let { x, y } of shape[0]) {\n    if (offsetY < y) offsetY = y;\n    if (offsetX < x) offsetX = x;\n  }\n\n  return new Shape(\n    Math.floor((sizeX - offsetX) / 2),\n    -1 * offsetY,\n    ...shape\n  );\n};\n\nexport default {\n  getShape\n};\n","/**\n * 方块形状类\n * @export Shape\n * @class Shape\n */\nexport default class Shape {\n  constructor(offsetX, offsetY, ...states) {\n    this.states = states;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n    this.stateIndex = 0;\n    this.prevCoordinates = [];\n    this.coordinates = this.states[this.stateIndex].map(({ x, y }) => ({\n      x: x + this.offsetX,\n      y: y + this.offsetY\n    }));\n    this.timestamp = Date.now();\n\n    this.getRawCoordinates = this.getRawCoordinates.bind(this);\n    this.getCoordinates = this.getCoordinates.bind(this);\n    this.left = this.left.bind(this);\n    this.right = this.right.bind(this);\n    this.down = this.down.bind(this);\n    this.rotate = this.rotate.bind(this);\n  }\n\n  getRawCoordinates() {\n    return this.states[this.stateIndex];\n  }\n\n  getCoordinates() {\n    this.prevCoordinates = this.coordinates;\n    this.coordinates = this.states[this.stateIndex].map(({ x, y }) => ({\n      x: x + this.offsetX,\n      y: y + this.offsetY\n    }));\n    return this.coordinates;\n  }\n\n  left() {\n    this.offsetX--;\n    this.getCoordinates();\n  }\n\n  right() {\n    this.offsetX++;\n    this.getCoordinates();\n  }\n\n  down() {\n    this.offsetY++;\n    this.getCoordinates();\n  }\n\n  rotate() {\n    this.stateIndex++;\n    if (this.stateIndex == this.states.length) this.stateIndex = 0;\n    this.getCoordinates();\n  }\n}\n","/**\n * @file 动画模块\n * @version 1.0.0\n */\n\nimport { extend } from '../util';\nimport DB from './db';\n\nconst SCREEN = {\n\tmatrixSizeY: 0,\n\tactivate: function() {},\n\tinactivate: function() {},\n\thighlight: function() {},\n\tunhighlight: function() {}\n};\n\n/**\n * 初始化\n * @param {object} screenOptions 屏幕配置选项\n */\nconst initialize = (screenOptions) => {\n\textend(SCREEN, screenOptions);\n};\n\n/**\n * 高亮\n * @param {Array<integer>} yCoordinates Y轴坐标集合\n * @param {integer} count 计数\n * @param {function} callback 回调\n * @param {integer} timer 定时器ID\n */\nconst highlight = (yCoordinates, count, callback, timer) => {\n\tif (count % 2 == 0) {\n\t\tSCREEN.unhighlight(yCoordinates);\n\t} else {\n\t\tSCREEN.highlight(yCoordinates);\n\t}\n\n\tcount--;\n\ttimer && clearTimeout(timer);\n\tif (count >= 0) {\n\t\ttimer = setTimeout(() => {\n\t\t\treturn highlight(yCoordinates, count, callback, timer);\n\t\t}, 150);\n\t} else {\n\t\tcallback && callback();\n\t}\n};\n\n/**\n * 填满屏幕\n * @param {function} callback 回调\n * @param {integer} timer 定时器ID\n * @param {integer} y Y轴坐标\n * @returns\n */\nconst fillScreen = (callback, timer, y) => {\n\tif (y === undefined) y = SCREEN.matrixSizeY - 1;\n\ttimer && clearTimeout(timer);\n\n\tlet coordinates = DB.fillRow(y);\n\tif (coordinates && coordinates.length > 0) {\n\t\tSCREEN.activate(coordinates);\n\t} else {\n\t\tcallback && callback();\n\t\treturn;\n\t}\n\n\ty--;\n\ttimer = setTimeout(() => {\n\t\treturn fillScreen(callback, timer, y);\n\t}, 70);\n};\n\n/**\n * 清理屏幕\n * @param {function} callback 回调\n * @param {integer} timer 定时器ID\n * @param {integer} y Y轴坐标\n * @returns\n */\nconst clearScreen = (callback, timer, y) => {\n\tif (y === undefined) y = 0;\n\ttimer && clearTimeout(timer);\n\n\tlet coordinates = DB.clearRow(y);\n\tif (coordinates && coordinates.length > 0) {\n\t\tSCREEN.inactivate(coordinates);\n\t} else {\n\t\tcallback && callback();\n\t\treturn;\n\t}\n\n\ty++;\n\ttimer = setTimeout(() => {\n\t\treturn clearScreen(callback, timer, y);\n\t}, 70);\n};\n\nexport default {\n\tinitialize,\n\thighlight,\n\tfillScreen,\n\tclearScreen\n};\n"],"sourceRoot":""}